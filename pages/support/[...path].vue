<template>
  <div lang="fr">
    <div class="container">
      <Breadcrumb>
        <BreadcrumbItem
          to="/"
        >
          Accueil
        </BreadcrumbItem>
        <BreadcrumbItem>
          Support
        </BreadcrumbItem>
      </Breadcrumb>
    </div>
    <div class="border-b border-gray-lowest">
      <div class="container">
        <h1 class="text-4.5xl font-extrabold pt-10 pb-[3.75rem] !mb-0 max-w-2xl text-gray-title">
          Bienvenue sur le support de la plateforme data.gouv.fr
        </h1>
      </div>
    </div>
    <div class="container my-15 space-y-8">
      <h2 class="text-4xl font-extrabold text-gray-title mt-15 mb-16">
        Avant de nous contacter, pensez √† consulter le forum et nos guides : vous y trouverez peut-√™tre d√©j√† la r√©ponse √† votre question !
      </h2>
      <div class="grid gap-5 md:grid-cols-2">
        <SupportCard
          class="min-w-0"
          image="/nuxt_images/guides.svg"
          title="Guides"
          description="Les guides vous accompagnent pas √† pas pour publier, explorer et r√©utiliser les donn√©es ouvertes en toute simplicit√©."
        >
          <template #link>
            <div class="flex flex-col items-end mt-1 *:font-bold *:h-8">
              <BrandedButton
                href="https://guides.data.gouv.fr/guide-data.gouv.fr"
                color="tertiary"
                :icon="RiArrowRightLine"
                :icon-right="true"
                size="sm"
              >
                Voir la documentation de data.gouv.fr
              </BrandedButton>
              <BrandedButton
                href="https://guides.data.gouv.fr/guides-open-data"
                color="tertiary"
                :icon="RiArrowRightLine"
                :icon-right="true"
                size="sm"
              >
                Voir les guides sur l'open data
              </BrandedButton>
              <BrandedButton
                href="https://guides.data.gouv.fr/reutiliser-des-donnees"
                color="tertiary"
                :icon="RiArrowRightLine"
                :icon-right="true"
                size="sm"
              >
                Voir les guides sur l'utilisation des donn√©es
              </BrandedButton>
            </div>
          </template>
        </SupportCard>
        <SupportCard
          class="min-w-0"
          image="/nuxt_images/forum.svg"
          title="Forum"
          description="Echangez avec la communaut√©, partagez vos retours sur la plateforme et demandez l'ouverture de donn√©es."
        >
          <template #link>
            <div class="flex flex-col items-end mt-1 *:font-bold *:h-8">
              <BrandedButton
                href="https://forum.data.gouv.fr/c/recherche-et-ouverture-de-donnees/"
                color="tertiary"
                :icon="RiArrowRightLine"
                :icon-right="true"
                size="sm"
              >
                Voir les recherches des donn√©es
              </BrandedButton>
              <BrandedButton
                href="https://forum.data.gouv.fr/c/retours-sur-la-plateforme-data-gouv-fr/"
                color="tertiary"
                :icon="RiArrowRightLine"
                :icon-right="true"
                size="sm"
              >
                Voir les retours sur la plateforme data.gouv.fr
              </BrandedButton>
              <BrandedButton
                :href="config.public.forumUrl"
                color="tertiary"
                :icon="RiArrowRightLine"
                :icon-right="true"
                size="sm"
              >
                Voir les autres questions / r√©ponses
              </BrandedButton>
            </div>
          </template>
        </SupportCard>
      </div>
      <h2 class="text-4xl font-extrabold text-gray-title my-16">
        Questions les plus fr√©quentes
      </h2>
      <AccordionGroup
        @open="accordionOpened"
      >
        <!-- üè¢ Entreprise -->
        <h3 class="text-2xl font-bold text-gray-title mt-10 mb-4">
          Entreprise
        </h3>
        <Accordion
          title="Vos donn√©es sont visibles dans la base Sirene et vous souhaitez les rendre priv√©es ?"
          heading="h4"
        >
          <p class="m-0">
            Si vous souhaitez rendre priv√©es les donn√©es de votre organisation, vous devez en faire la demande aupr√®s de l'Insee qui publie ces donn√©es dans le r√©pertoire Sirene. Les √©tapes de cette demande sont d√©taill√©es dans <a
              href="https://www.insee.fr/fr/information/7456564"
              target="_blank"
            >ce guide de l'Insee</a>. Pour les entrepreneurs individuels, voici un lien direct vers la <a href="https://statut-diffusion-sirene.insee.fr/">t√©l√©proc√©dure</a>.
          </p>
        </Accordion>
        <Accordion
          title="Vous cherchez votre num√©ro de SIRET, SIREN ou RNA ?"
          heading="h4"
        >
          <p>
            Si vous recherchez votre num√©ro SIRET ou SIREN, vous pouvez vous rendre sur le site <a
              href="https://annuaire-entreprises.data.gouv.fr/"
              target="_blank"
            >Annuaire des entreprises</a>.
          </p>
          <p class="m-0">
            Si vous √™tes une association et recherchez votre num√©ro RNA,
            vous pouvez consulter le moteur de recherche des associations du <a
              href="https://www.journal-officiel.gouv.fr/associations/recherche/"
              target="_blank"
            >journal officiel</a> (dont nous ne sommes pas responsables).
            Pour plus d'informations, vous pouvez consulter le site <a
              href="https://www.service-public.fr/associations"
              target="_blank"
            >Service-Public.fr</a>.
          </p>
        </Accordion>
        <Accordion
          title="Vous avez une question sur un organisme de formation ou une certification Qualiopi ?"
          heading="h4"
        >
          <p>
            Notre √©quipe n'est pas en mesure de vous aider sur ces questions.
            Si vous ne trouvez pas r√©ponse √† votre question dans les √©l√©ments suivants vous pouvez contacter <a
              href="https://travail-emploi.gouv.fr/ministere/article/nous-contacter"
              target="_blank"
            >le Minist√®re du Travail</a>.
          </p>
          <p>
            <strong>Vous ne trouvez pas votre organisme de formation dans la liste ?</strong><br>
            Retrouvez toutes les informations utiles pour d√©clarer votre organisme ou transmettre votre Bilan P√©dagogique et Financier sur le site du Minist√®re du travail :
            <a
              href="http://travail-emploi.gouv.fr/formation-professionnelle/organismes-de-formation-fonctionnement/organismes-formation"
              target="_blank"
            >les formalit√©s de cr√©ation et de fonctionnement des organismes de formation</a>.
          </p>
          <p>
            <strong>Vous souhaitez modifier certaines informations ?</strong><br>
            Les informations sont issues des d√©clarations annuelles effectu√©es par l'organisme de formation aupr√®s du service r√©gional de contr√¥le de sa DREETS,
            mais vous pouvez demander √† tout moment la modification de certaines informations en contactant votre DREETS ou en acc√©dant √† votre espace personnel sur
            <a
              href="https://www.monactiviteformation.emploi.gouv.fr/"
              target="_blank"
            >l'application Mon Activit√© Formation</a>.
          </p>
          <p class="mb-0">
            <strong>Les informations concernant votre certification QUALIOPI vous semblent erron√©es ?</strong><br>
            Contactez votre organisme certificateur afin qu'il transmette votre certification. Attention de bien lui fournir votre nouveau NDA si celui-ci a chang√© r√©cemment.
          </p>
        </Accordion>

        <!-- üìç Donn√©es fonci√®res, cadastre et adresses -->
        <h3 class="text-2xl font-bold text-gray-title mt-10 mb-4">
          Donn√©es fonci√®res, cadastre et adresses
        </h3>
        <Accordion
          title="Vous avez une question sur l'application DVF (demandes de valeurs fonci√®res) ?"
          heading="h4"
        >
          <p>
            Vous pouvez consulter la <a
              href="https://explore.data.gouv.fr/fr/immobilier?onglet=faq"
              target="_blank"
            >foire aux questions</a> de l'application. Les bases de donn√©es sources, ainsi que le code source sont d√©taill√©s <a href="https://explore.data.gouv.fr/fr/immobilier?onglet=sources">ici</a>.
          </p>
          <p class="font-bold mb-1">
            Les jeux de donn√©es et API "demandes de valeurs fonci√®res" :
          </p>
          <ul class="list-disc pl-4">
            <li>
              <a href="https://www.data.gouv.fr/fr/datasets/demandes-de-valeurs-foncieres/">Base de donn√©es "Demandes de valeurs fonci√®res"</a> du Minist√®re de l'√âconomie, des Finances et de l'Industrie
            </li>
            <li>
              <a href="https://www.data.gouv.fr/fr/datasets/demandes-de-valeurs-foncieres-geolocalisees/">Base de donn√©es "Demandes de valeurs fonci√®res g√©olocalis√©es"</a> de Data.gouv.fr
            </li>
            <li>
              <a href="https://www.data.gouv.fr/fr/dataservices/api-donnees-foncieres/">API donn√©es fonci√®res</a> du CEREMA, en acc√®s restreint √† certaines administrations.
            </li>
          </ul>
        </Accordion>
        <Accordion
          title="Vous avez une question sur le cadastre ?"
          heading="h4"
        >
          <p class="mb-0">
            Si vous avez une question sur le cadastre (rechercher un propri√©taire,
            remonter une erreur dans les donn√©es de valeur fonci√®re, s‚Äôinformer sur la mitoyennet√©, etc.), nous vous invitons √† consulter notre <a
              href="https://guides.data.gouv.fr/reutiliser-des-donnees/autour-du-cadastre/faq-cadastre"
              target="_blank"
            >¬´ Foire aux questions sur le cadastre ¬ª</a>.
            Pour toute question sur l‚Äôutilisation et la manipulation des donn√©es du cadastre, vous pouvez consulter <a
              href="https://guides.data.gouv.fr/reutiliser-des-donnees/autour-du-cadastre"
              target="_blank"
            >le guide d√©di√©</a>.
          </p>
        </Accordion>
        <Accordion
          title="Je constate une erreur dans le plan cadastral, comment la faire corriger ?"
          heading="h4"
        >
          <p class="mb-0">
            Ce type de correction doit √™tre demand√© au Centre des imp√¥ts fonciers de votre d√©partement,
            dont vous trouverez les coordonn√©es sur <a
              href="https://www.service-public.fr/particuliers/recherche?keyword=centre%20des%20impots%20fonciers&rubricFilter=annuaire"
              target="_blank"
            >service-public.fr</a>.
          </p>
        </Accordion>
        <Accordion
          title="Que puis-je faire avec les donn√©es ?"
          heading="h4"
        >
          <p>
            Les donn√©es cadastrales diffus√©es sur ce site sont disponibles sous <a
              href="https://www.etalab.gouv.fr/wp-content/uploads/2017/04/ETALAB-Licence-Ouverte-v2.0.pdf"
              target="_blank"
            >Licence Ouverte 2.0
            </a>.
          </p>
          <p>
            Elles peuvent √™tre utilis√©es librement, y compris exploit√©es commercialement, tant que
            la source et la date de mise √† jour sont cit√©es.
          </p>
          <p class="mb-0">
            N‚Äôh√©sitez pas √† vous r√©f√©rer au texte de la Licence Ouverte 2.0 pour plus de pr√©cision.
          </p>
        </Accordion>
        <Accordion
          title="Vous avez une question sur la base adresse nationale ? Une adresse est incorrecte ?"
          heading="h4"
        >
          <p class="mb-0">
            Vous pouvez consulter la <a
              href="https://adresse.data.gouv.fr/nous-contacter"
              target="_blank"
            >foire aux questions d√©di√©e</a>.
          </p>
        </Accordion>

        <!-- ‚öôÔ∏è APIs publiques -->
        <h3 class="text-2xl font-bold text-gray-title mt-10 mb-4">
          APIs publiques
        </h3>
        <Accordion
          title="Vous avez une question sur les limites d'appels de l‚ÄôAPI d√©coupage administratif (API Geo) ?"
          heading="h4"
        >
          <p class="mb-0">
            Les volum√©tries d'appel sont d√©crites dans la <a href="https://www.data.gouv.fr/fr/dataservices/api-decoupage-administratif-api-geo/">fiche de l'API</a>.
          </p>
          <p>
            <strong>Est-il possible de faire lever les limites de l‚ÄôAPI ?</strong><br>
            Oui, mais uniquement si vous √™tes un service public ou charg√© d‚Äôune mission de service public.
            Dans le cas contraire, vous pouvez aussi h√©berger notre API de g√©ocodage chez vous,
            en suivant <a
              href="https://github.com/BaseAdresseNationale/addok-docker"
              target="_blank"
            >ces instructions</a>.
          </p>
        </Accordion>
        <Accordion
          title="Vous recherchez une API ou une base de donn√©es des plaques d'immatriculation, permis de conduire, ou des cartes grises ?"
          heading="h4"
        >
          <p>
            Les volum√©tries d'appel sont d√©crites dans la <a href="https://www.data.gouv.fr/fr/dataservices/api-decoupage-administratif-api-geo/">fiche de l'API</a>.
          </p>
          <p class="mb-0">
            Il existe des API et bases de donn√©es, celles-ci ne sont pas r√©f√©renc√©es sur data.gouv.fr √† ce jour. Ces API et bases de donn√©es, qui sont op√©r√©es par le Minist√®re de l'Int√©rieur, sont en acc√®s restreint √† un petit nombre d'acteurs institutionnels. Notre support n'est pas en mesure de vous aider √† ce sujet.
          </p>
        </Accordion>
        <Accordion
          :title="`Vous cherchez l'API Tiers de prestations pour b√©n√©ficier du dispositif d'avance imm√©diate du cr√©dit d'imp√¥t ¬´‚ÄØservice √† la personne‚ÄØ¬ª ?`"
          heading="h4"
        >
          <p class="mb-0">
            Cette API n'est pas r√©f√©renc√©e sur data.gouv.fr car il s'agit d'une d√©marche en ligne. Vous pouvez acc√©der √† cette d√©marche de l'Urssaf en suivant <a
              href="https://www.demarches-simplifiees.fr/commencer/api-tiers-de-prestations"
              target="_blank"
            >ce lien vers D√©marches simplifi√©es</a>.
          </p>
        </Accordion>
        <Accordion
          title="Vous rencontrez un probl√®me avec DataPass ?"
          heading="h4"
        >
          <p class="mb-0">
            DataPass est un service permettant aux administrations et collectivit√©s d'√™tre habilit√©es √† acc√©der √† des donn√©es en acc√®s restreint. Que vous soyez une administration fournisseur de donn√©es ou utilisatrice de donn√©es, vous pouvez vous r√©f√©rez √† la <a
              href="https://datapass.api.gouv.fr/faq"
              target="_blank"
            >FAQ du service Datapass</a>.
          </p>
        </Accordion>

        <!-- üì¶ Autres donn√©es -->
        <h3 class="text-2xl font-bold text-gray-title mt-10 mb-4">
          Autres donn√©es
        </h3>
        <Accordion
          title="Vous avez une question sur le r√©pertoire national des infrastructures de recharge pour v√©hicules √©lectriques (IRVE) ?"
          heading="h4"
        >
          <p class="mb-0">
            Nous vous invitons √† consulter <a
              href="https://doc.transport.data.gouv.fr/producteurs/infrastructures-de-recharge-de-vehicules-electriques-irve"
              target="_blank"
            >la documentation d√©di√©e</a>
            concernant la cr√©ation et la publication des donn√©es de ces donn√©es.
          </p>
        </Accordion>
        <Accordion
          title="Vous avez une question sur des donn√©es relatives au COVID-19 ?"
          heading="h4"
        >
          <ul class="list-disc pl-4">
            <li>
              Pour toute information sur la COVID-19 vous pouvez consulter le site <a
                href="https://www.gouvernement.fr/info-coronavirus"
                target="_blank"
              >gouvernement.fr</a>.
            </li>
            <li>
              Pour trouver un rendez-vous, vous pouvez consulter <a
                href="https://www.sante.fr/"
                target="_blank"
              >sante.fr</a>.
            </li>
            <li>
              Pour r√©cup√©rer votre attestation, vous pouvez consulter votre appli TousAntiCovid ou votre espace <a
                href="https://www.ameli.fr"
                target="_blank"
              >ameli.fr</a>.
            </li>
          </ul>
        </Accordion>

        <!-- üßæ Autres questions fr√©quentes -->
        <h3 class="text-2xl font-bold text-gray-title mt-10 mb-4">
          Autres questions fr√©quentes
        </h3>
        <Accordion
          title="Vous avez une question relative √† vos donn√©es personnelles ?"
          heading="h4"
        >
          <p class="mb-0">
            L'organisme en mesure de vous aider est <a
              href="https://www.cnil.fr/"
              target="_blank"
            >la Commission nationale de l'informatique et des libert√©s (CNIL)</a>.
          </p>
        </Accordion>
        <Accordion
          title="Vous avez une question sur un titre de s√©jour ?"
          heading="h4"
        >
          <p class="mb-0">
            Le site data.gouv.fr ne permet pas aux particuliers de remplir des formalit√©s administratives et notre support n'est pas en mesure de vous aider sur ces sujets.
            Vous pouvez vous r√©f√©rer √† l'administration comp√©tente ou consulter les liens suivants :
          </p>
          <ul class="list-disc pl-4">
            <li>
              <a
                href="https://www.service-public.fr/particuliers/vosdroits/N110"
                target="_blank"
              >La fiche d√©di√©e sur Service-Public.fr</a>
            </li>
            <li>
              <a
                href="https://www.refugies.info/demarche/5dc2da982e9859001680b8a2"
                target="_blank"
              >Le site refugies.info</a>
            </li>
            <li>
              <a
                href="https://administration-etrangers-en-france.interieur.gouv.fr/particuliers/#/contact"
                target="_blank"
              >Contacter le service comp√©tent du Minist√®re de l'Int√©rieur</a>
            </li>
          </ul>
        </Accordion>
        <Accordion
          title="Vous avez un doute ou avez √©t√© victime de fraude ou d'escroquerie ?"
          heading="h4"
        >
          <p class="mb-1">
            Notre √©quipe n'est pas en mesure de vous aider sur ces questions. Vous pouvez vous r√©f√©rer √† :
          </p>
          <ul class="list-disc pl-4">
            <li>
              <a
                href="https://www.service-public.fr/particuliers/vosdroits/F1520"
                target="_blank"
              >La fiche pratique escroquerie de Service-Public.fr</a>
            </li>
            <li>
              <a
                href="https://www.service-public.fr/particuliers/vosdroits/F34800"
                target="_blank"
              >La fiche pratique phishing (hame√ßonnage) sur Service-Public.fr</a>
            </li>
            <li>
              <a
                href="https://www.cybermalveillance.gouv.fr/diagnostic/accueil"
                target="_blank"
              >L‚Äôoutil de diagnostic sur cybermalveillance.gouv.fr</a>
            </li>
          </ul>
        </Accordion>
        <Accordion
          title="Vous avez une question sur le compte professionnel de formation (CPF) ?"
          heading="h4"
        >
          <p class="mb-0">
            Notre √©quipe n'est pas en mesure de vous aider sur ces questions. Vous pouvez vous r√©f√©rer √†
            <a
              href="https://www.service-public.fr/particuliers/vosdroits/F10705"
              target="_blank"
            >la fiche pratique sur Service-Public.fr</a>.
          </p>
        </Accordion>
      </AccordionGroup>

      <h2
        id="support-tree"
        class="text-4xl font-extrabold text-gray-title my-16"
      >
        Vous n‚Äôavez pas trouv√© ce que vous cherchez ?
      </h2>
      <div
        v-for="(question, index) in questions"
        :key="question.id"
      >
        <SupportTitle
          v-if="question.title"
          :id="question.id"
        >
          {{ question.title }}
        </SupportTitle>
        <SupportChoices
          :question
          :selected="answers[index]"
          @select="(id) => { if (id) select(id, index) }"
        />
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { BrandedButton } from '@datagouv/components-next'
import { RiArrowRightLine } from '@remixicon/vue'
import { id, title, choices } from '~/assets/config/support.toml'
import Breadcrumb from '~/components/Breadcrumb/Breadcrumb.vue'
import BreadcrumbItem from '~/components/Breadcrumbs/BreadcrumbItem.vue'
import type { Question } from '~/types/support'

const config = useRuntimeConfig()
const route = useRoute()
const firstQuestion: Question = { id, title, choices }
const questions = ref<Array<Question>>([firstQuestion])
const answers = ref<Array<string>>([])

const { t } = useTranslation()

useSeoMeta({
  title: t('Support'),
})

function updateUrl(path: string, hash = '') {
  const params = route.params.path ? (route.params.path as Array<string>).join('/') : ''
  const pathWithoutParams = route.params.path ? route.path.slice(0, route.path.indexOf(params)) : route.path
  const url = new URL(window.location.origin + pathWithoutParams + (path ? `${path}/` : path))
  url.hash = `#${hash}`
  window.history.replaceState(null, '', url)
}

function accordionOpened(id: string) {
  updateUrl('', id)
}

function select(id: string, index: number) {
  answers.value[index] = id
  updateUrl(answers.value.join('/'), 'support-tree')
}
onMounted(async () => {
  for (const level in route.params.path as Array<string>) {
    const answer = route.params.path[level]
    if (answer) {
      answers.value[level] = answer
    }
  }
})

watchEffect(async () => {
  questions.value = [firstQuestion]
  for (const step in answers.value) {
    const id = answers.value[step]
    const answer = questions.value[step] && 'choices' in questions.value[step] && questions.value[step].choices.find(choice => choice.id === id)
    if (answer) {
      questions.value.push(answer)
    }
  }
})
</script>
